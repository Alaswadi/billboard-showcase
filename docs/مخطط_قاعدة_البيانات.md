# مخطط قاعدة البيانات - نظام إدارة اللوحات الإعلانية

**المؤلف:** Manus AI  
**التاريخ:** 19 نوفمبر 2025  
**الإصدار:** 1.0

---

## نظرة عامة على البنية

يستخدم نظام إدارة اللوحات الإعلانية قاعدة بيانات علائقية مصممة لدعم جميع المتطلبات الوظيفية مع الحفاظ على سلامة البيانات والأداء. تم تصميم المخطط مع التطبيع المناسب لتقليل التكرار مع ضمان كفاءة الاستعلام. يستخدم النظام SQLite للتطوير وقابل للترقية إلى PostgreSQL أو MySQL للنشر على نطاق واسع.

## جداول قاعدة البيانات

### جدول المستخدمين (Users)

يخزن جدول المستخدمين معلومات المصادقة والملف الشخصي لجميع مستخدمي النظام. يدعم الجدول ثلاثة أدوار مستخدم متميزة: المكتب الحكومي، وشركة الإعلان، والشركة المستخدمة النهائية.

| العمود | النوع | القيود | الوصف |
|--------|------|---------|-------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | معرف فريد للمستخدم |
| email | VARCHAR(255) | UNIQUE, NOT NULL | عنوان البريد الإلكتروني للمستخدم |
| password_hash | VARCHAR(255) | NOT NULL | كلمة المرور المشفرة باستخدام bcrypt |
| role | VARCHAR(50) | NOT NULL | دور المستخدم (government, advertising_company, end_user) |
| company_id | INTEGER | FOREIGN KEY | مرجع إلى جدول الشركات (NULL للمستخدمين الحكوميين) |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني لإنشاء الحساب |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني لآخر تحديث |

يضمن قيد UNIQUE على عمود البريد الإلكتروني أن كل مستخدم لديه بيانات اعتماد تسجيل دخول متميزة. يربط المفتاح الأجنبي company_id المستخدمين بمؤسساتهم، مما يسمح بإدارة فعالة للمستخدمين المتعددين من نفس الشركة.

### جدول الشركات (Companies)

يخزن جدول الشركات معلومات حول شركات الإعلان والشركات المستخدمة النهائية التي تعمل داخل النظام.

| العمود | النوع | القيود | الوصف |
|--------|------|---------|-------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | معرف فريد للشركة |
| name | VARCHAR(255) | NOT NULL | اسم الشركة الرسمي |
| type | VARCHAR(50) | NOT NULL | نوع الشركة (advertising_company, end_user) |
| contact_email | VARCHAR(255) | NOT NULL | عنوان البريد الإلكتروني الرئيسي للاتصال |
| contact_phone | VARCHAR(50) | | رقم الهاتف للاتصال |
| address | TEXT | | عنوان الشركة الفعلي |
| registration_number | VARCHAR(100) | | رقم التسجيل التجاري |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني لتسجيل الشركة |

يسمح عمود النوع للنظام بالتمييز بين شركات الإعلان (التي تمتلك وتدير لوحات إعلانية متعددة) والشركات المستخدمة النهائية (التي تمتلك لوحاتها الإعلانية الخاصة).

### جدول اللوحات الإعلانية (Billboards)

يخزن جدول اللوحات الإعلانية معلومات حول جميع مواقع اللوحات الإعلانية، سواء المعتمدة أو المعلقة أو المرفوضة.

| العمود | النوع | القيود | الوصف |
|--------|------|---------|-------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | معرف فريد للوحة الإعلانية |
| unique_number | VARCHAR(50) | UNIQUE, NOT NULL | رقم تعريف يتم إنشاؤه تلقائياً للوحة الإعلانية |
| location | TEXT | NOT NULL | العنوان الوصفي للموقع |
| latitude | DECIMAL(10,8) | | إحداثيات GPS - خط العرض |
| longitude | DECIMAL(11,8) | | إحداثيات GPS - خط الطول |
| specifications | TEXT | | المواصفات الفنية (الأبعاد، النوع، إلخ) |
| owner_type | VARCHAR(50) | NOT NULL | نوع المالك (advertising_company, end_user) |
| owner_id | INTEGER | FOREIGN KEY, NOT NULL | مرجع إلى جدول الشركات |
| status | VARCHAR(50) | NOT NULL | حالة الموافقة (pending, approved, rejected) |
| image_path | TEXT | | مسار صورة الموقع |
| approval_notes | TEXT | | ملاحظات من المراجع الحكومي |
| approved_by | INTEGER | FOREIGN KEY | مرجع إلى المستخدم الذي وافق |
| approved_at | DATETIME | | طابع زمني للموافقة |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني لتقديم الموقع |

يتم إنشاء unique_number تلقائياً عند الموافقة على اللوحة الإعلانية ويعمل كمعرف مرئي للمستخدم. يسمح عمود الحالة بتتبع اللوحات الإعلانية من خلال سير عمل الموافقة.

### جدول الإعلانات (Advertisements)

يخزن جدول الإعلانات معلومات حول تقديمات محتوى الإعلانات لمواقع اللوحات الإعلانية المعتمدة.

| العمود | النوع | القيود | الوصف |
|--------|------|---------|-------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | معرف فريد للإعلان |
| billboard_id | INTEGER | FOREIGN KEY, NOT NULL | مرجع إلى اللوحة الإعلانية |
| company_id | INTEGER | FOREIGN KEY, NOT NULL | مرجع إلى الشركة المقدمة |
| content_path | TEXT | NOT NULL | مسار ملف محتوى الإعلان |
| description | TEXT | | وصف الحملة الإعلانية |
| status | VARCHAR(50) | NOT NULL | حالة الموافقة (pending, approved, rejected, auto_approved) |
| submission_date | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني للتقديم |
| review_deadline | DATETIME | NOT NULL | الموعد النهائي للموافقة التلقائية (24 ساعة) |
| approval_date | DATETIME | | طابع زمني للموافقة/الرفض |
| reviewed_by | INTEGER | FOREIGN KEY | مرجع إلى المراجع الحكومي |
| review_notes | TEXT | | ملاحظات من المراجع |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني للإنشاء |

يتم تعيين review_deadline تلقائياً إلى 24 ساعة من submission_date. يتحقق النظام من المواعيد النهائية المنتهية ويحدث الحالة إلى auto_approved تلقائياً عند الضرورة.

### جدول التراخيص (Licenses)

يخزن جدول التراخيص معلومات حول التراخيص السنوية الصادرة لمواقع اللوحات الإعلانية المعتمدة.

| العمود | النوع | القيود | الوصف |
|--------|------|---------|-------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | معرف فريد للترخيص |
| billboard_id | INTEGER | FOREIGN KEY, NOT NULL | مرجع إلى اللوحة الإعلانية |
| license_number | VARCHAR(100) | UNIQUE, NOT NULL | رقم ترخيص يتم إنشاؤه تلقائياً |
| start_date | DATE | NOT NULL | تاريخ بدء الترخيص |
| end_date | DATE | NOT NULL | تاريخ انتهاء الترخيص |
| amount | DECIMAL(10,2) | NOT NULL | رسوم الترخيص |
| is_paid | BOOLEAN | DEFAULT FALSE | حالة الدفع |
| payment_date | DATETIME | | طابع زمني للدفع |
| payment_method | VARCHAR(50) | | طريقة الدفع المستخدمة |
| payment_reference | VARCHAR(255) | | رقم مرجع الدفع |
| issued_by | INTEGER | FOREIGN KEY | مرجع إلى المستخدم الحكومي الذي أصدر |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | طابع زمني للإصدار |

يتم حساب end_date تلقائياً بإضافة سنة واحدة إلى start_date. يتتبع النظام التراخيص منتهية الصلاحية ويرسل إشعارات تجديد قبل 30 يوماً من انتهاء الصلاحية.

## العلاقات بين الجداول

### علاقة المستخدمين والشركات

يرتبط كل مستخدم (باستثناء المستخدمين الحكوميين) بشركة واحدة من خلال المفتاح الأجنبي company_id. تسمح هذه العلاقة بإدارة مستخدمين متعددين من نفس المؤسسة مع الحفاظ على أذونات فردية. يمكن أن يكون للشركة الواحدة مستخدمون متعددون، مما يدعم الفرق التعاونية.

### علاقة الشركات واللوحات الإعلانية

تمتلك كل شركة لوحات إعلانية متعددة من خلال المفتاح الأجنبي owner_id في جدول اللوحات الإعلانية. يحدد عمود owner_type ما إذا كانت اللوحة الإعلانية مملوكة لشركة إعلان أو شركة مستخدم نهائي. تسمح هذه العلاقة بإدارة محفظة فعالة وتقارير على مستوى الشركة.

### علاقة اللوحات الإعلانية والإعلانات

يمكن أن تحتوي كل لوحة إعلانية على إعلانات متعددة بمرور الوقت، مما يمثل حملات إعلانية مختلفة. يربط المفتاح الأجنبي billboard_id في جدول الإعلانات كل تقديم محتوى بموقع لوحة إعلانية معتمد محدد. تحتفظ هذه العلاقة بسجل كامل لجميع الإعلانات التي تم عرضها في كل موقع.

### علاقة اللوحات الإعلانية والتراخيص

يمكن أن تحتوي كل لوحة إعلانية على تراخيص متعددة بمرور الوقت، مما يمثل فترات التجديد السنوية. يربط المفتاح الأجنبي billboard_id في جدول التراخيص كل ترخيص بموقع لوحة إعلانية محدد. تسمح هذه العلاقة بتتبع سجل الترخيص الكامل ومراقبة الامتثال.

## الفهارس وتحسين الأداء

لضمان أداء الاستعلام الأمثل، يتم إنشاء الفهارس التالية:

- **فهرس على Users.email**: يسرع عمليات البحث عن المصادقة
- **فهرس على Billboards.unique_number**: يسمح بالبحث السريع عن اللوحات الإعلانية
- **فهرس على Billboards.status**: يحسن استعلامات التصفية حسب الحالة
- **فهرس على Advertisements.status**: يدعم استعلامات الموافقة المعلقة الفعالة
- **فهرس على Licenses.end_date**: يسهل فحوصات انتهاء الصلاحية السريعة
- **فهرس مركب على (Billboards.owner_type, Billboards.owner_id)**: يحسن استعلامات اللوحات الإعلانية الخاصة بالشركة

## اعتبارات سلامة البيانات

يطبق المخطط سلامة البيانات من خلال عدة آليات:

- **قيود المفتاح الأجنبي**: تضمن أن جميع المراجع بين الجداول صالحة
- **قيود UNIQUE**: تمنع البيانات المكررة للمعرفات الحرجة
- **قيود NOT NULL**: تضمن أن الحقول المطلوبة تحتوي دائماً على قيم
- **قيود CHECK**: تتحقق من أن القيم تقع ضمن نطاقات أو مجموعات صالحة
- **قيود DEFAULT**: توفر قيماً معقولة للحقول الاختيارية

## استراتيجية النسخ الاحتياطي والاسترداد

يجب إجراء نسخ احتياطية منتظمة لقاعدة البيانات لمنع فقدان البيانات. تتضمن الاستراتيجية الموصى بها:

- **نسخ احتياطية يومية كاملة**: نسخ احتياطي كامل لقاعدة البيانات كل 24 ساعة
- **نسخ احتياطية تزايدية كل ساعة**: التقاط التغييرات منذ آخر نسخ احتياطي
- **الاحتفاظ بالنسخ الاحتياطية**: الاحتفاظ بالنسخ الاحتياطية اليومية لمدة 30 يوماً
- **اختبار الاسترداد**: اختبار منتظم لإجراءات استرداد النسخ الاحتياطية

---

**© 2025 Manus AI. جميع الحقوق محفوظة.**
